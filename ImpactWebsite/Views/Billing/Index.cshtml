@using Microsoft.Extensions.Options
@using ImpactWebsite.Models.BillingModels
@model IEnumerable<ImpactWebsite.Models.BillingModels.BillingDetailViewModel>


@inject IOptions<StripeSettings> Stripe
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = "Billing";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}



<h2>Billing Dashboard</h2>
<br />
@Html.Partial("_PaymentDetails", (CreditCard)ViewBag.PaymentDetails)
<br />
@Html.Partial("_BillingAddress", (BillingAddress)ViewBag.BillingAddress)
<br />

<h3>Stripe Pay</h3>

<form action="/Billing/Charge" method="POST">
    <article>
        <label>Amount: $@ViewData["amount"]</label>
    </article>
    <script src="https://checkout.stripe.com/v2/checkout.js"
            class="stripe-button"
            data-image="/images/favicon.png"
            data-key="@Stripe.Value.PublishableKey"
            data-name="Impact Website"
            data-locale="auto"
            data-description="Modules $@ViewData["amount"]"
            data-amount="@ViewData["amountInt"]"
            data-currency="cad"
            data-billing-address="false"
            data-zip-code="true"
            data-email="@ViewData["email"]">
    </script>
</form>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.UserId)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.UserEmail)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.ModuleName)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.UserId)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.UserEmail)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ModuleName)
            </td>

        </tr>
    }

</table>